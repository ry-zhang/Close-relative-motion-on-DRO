function DRO_test
% 
% 绘制DRO轨道簇
% 
% 作者：张晨
% 单位：中科院空间应用工程与技术中心
% 时间：2021年3月30日
% chenzhang@csu.ac.cn
% -----------------------------------------------------------

clc; clear; close all;
% dbstop if error
% 地月引力常数
mu = 0.01215058560962404; 
% 文件名
FileName = 'ResoOrb_2_1_2D1.txt';
% 打开数据文件
fid = fopen(FileName , 'r');
fgets(fid);
 tline = fgets(fid);
count = 1;
while ~feof(fid)
    
    xxNow = textscan(tline,'%f');
    
    
    xxNow = cell2mat(xxNow);
    X0Mtx(count,:) = xxNow';
    tline = fgets(fid);
    count = count+1;
end
% try
%     tline = fgets(fid);
%     % tline = fgets(fid);
%     count = 1;
%     while tline~=-1
%         tline = fgets(fid);
%         xxNow = textscan(tline,'%f');
%         
%         
%         xxNow = cell2mat(xxNow);
%         X0Mtx(count,:) = xxNow';
% %         tline = fgets(fid);
%         count = count +1 ;
%         
%     end
% catch
%     tline = fgets(fid);
%     tline = fgets(fid);
%     count = 1;
%     while tline~=-1
%         tline = fgets(fid);
%         xxNow = textscan(tline,'%f');
%         
%         
%         xxNow = cell2mat(xxNow);
%         X0Mtx(count,:) = xxNow';
% %         tline = fgets(fid);
%         count = count +1 ;
%     end
% end
%     
    fclose('all');
% % DRO轨道簇
% X0Mtx = [0.005303995654298                         0      9.95154501480999e-07                         0          10.5880299768115                         0          6.30749706595705
%     0.0866399960493618                         0      3.10612258763273e-08                         0            4.263680750635                         0          6.29645952152456
%     0.167975996444426                         0      5.44635929356846e-08                         0          2.98251106413455                         0          6.27911759318159
%     0.249311996839489                         0      9.23461865697633e-08                         0          2.30720873365635                         0           6.2507901690156
%     0.330647997234553                         0     -3.48502863312205e-10                         0          1.85176435543791                         0          6.20421748534132
%     0.411983997629617                         0      5.53616791096806e-09                         0          1.50598724718544                         0          6.12605000178816
%     0.493319998024681                         0      1.42530812000754e-09                         0          1.22535565415162                         0          5.99022260330428
%     0.574655998419745                         0      3.88951156958366e-10                         0         0.989014218061593                         0          5.74335048016289
%     0.655991998814809                         0      7.14661575768379e-11                         0          0.78788243470929                         0          5.27508350639483
%     0.737327999209872                         0     -6.42039213331429e-11                         0         0.622222451512701                         0          4.38973919426031
%     0.818663999604936                         0     -2.70700168824891e-10                         0         0.504644281005582                         0          2.95052212484007
%     0.9                         0     -2.75535754030073e-09                         0           0.4763914772214                         0          1.27956964348298];
% 
% X0Mtx = [0.272373959153627 0.000000000000000 0.000000000000000 0.000000000000000 2.162323602816495 0.000000000000000 6.239700794601118 2.376370061655153 
% 0.268721165213030 0.000000000000000 -0.004381358844750 0.000000000000000 2.184086999512501 0.000000000000000 6.241544313713187 2.369078389571513 
% 0.267993837104480 0.000000000000000 -0.008730985157763 0.000000000000000 2.187973781433167 0.000000000000000 6.241913217952662 2.367354387231249 
% 0.266794974810978 0.000000000000000 -0.013018504524835 0.000000000000000 2.194404211692617 0.000000000000000 6.242517545996418 2.364505336625018 
% 0.265143488748486 0.000000000000000 -0.017215899268466 0.000000000000000 2.203311499570759 0.000000000000000 6.243342484682380 2.360565607145829 
% 0.263063839793182 0.000000000000000 -0.021298360820513 0.000000000000000 2.214610273133037 0.000000000000000 6.244369019174265 2.355579607931361 
% 0.260584450738214 0.000000000000000 -0.025244747632425 0.000000000000000 2.228202983350075 0.000000000000000 6.245575288362323 2.349598873483381 
% 0.257736126933370 0.000000000000000 -0.029037703030307 0.000000000000000 2.243986257558324 0.000000000000000 6.246937926468071 2.342679179054096 
% 0.254550650157685 0.000000000000000 -0.032663498571982 0.000000000000000 2.261856543921190 0.000000000000000 6.248433248528591 2.334877988309136 
% 0.251059638795189 0.000000000000000 -0.036111690686992 0.000000000000000 2.281714680571410 0.000000000000000 6.250038199122383 2.326252402219989 
% 0.247293702534713 0.000000000000000 -0.039374676522720 0.000000000000000 2.303469287798051 0.000000000000000 6.251731040341634 2.316857657049380 
% 0.243281873649046 0.000000000000000 -0.042447218615342 0.000000000000000 2.327039068037717 0.000000000000000 6.253491795592982 2.306746133985901 
% 0.239051271522711 0.000000000000000 -0.045325986707591 0.000000000000000 2.352354198959259 0.000000000000000 6.255302488293345 2.295966796955262 
% 0.234626948484007 0.000000000000000 -0.048009145161786 0.000000000000000 2.379357036756500 0.000000000000000 6.257147222294613 2.284564960523574 
% 0.230031867155136 0.000000000000000 -0.050495998974247 0.000000000000000 2.408002334996044 0.000000000000000 6.259012149073547 2.272582295127481 
% 0.225286967152633 0.000000000000000 -0.052786700966474 0.000000000000000 2.438257150819659 0.000000000000000 6.260885360022381 2.260056992098967 
% 0.220411288321851 0.000000000000000 -0.054882016596750 0.000000000000000 2.470100570099927 0.000000000000000 6.262756733867229 2.247024029146345 
% 0.215422126652056 0.000000000000000 -0.056783139876225 0.000000000000000 2.503523344624440 0.000000000000000 6.264617761243189 2.233515494216232 
% 0.210335206610318 0.000000000000000 -0.058491552995528 0.000000000000000 2.538527501216851 0.000000000000000 6.266461361663627 2.219560940246242 
% 0.205164859620853 0.000000000000000 -0.060008922638205 0.000000000000000 2.575125955324063 0.000000000000000 6.268281702784303 2.205187754878619 
% 0.199924202898455 0.000000000000000 -0.061337026986990 0.000000000000000 2.613342139174499 0.000000000000000 6.270074027899460 2.190421537981338 
% 0.194625316091449 0.000000000000000 -0.062477708767170 0.000000000000000 2.653209635401494 0.000000000000000 6.271834494791972 2.175286486367801 
% 0.189279415455753 0.000000000000000 -0.063432851105078 0.000000000000000 2.694771789411677 0.000000000000000 6.273560027150537 2.159805789904564 
% 0.183897026811377 0.000000000000000 -0.064204374419103 0.000000000000000 2.738081255948530 0.000000000000000 6.275248178530618 2.144002046681619 
% 0.178488159457600 0.000000000000000 -0.064794253944758 0.000000000000000 2.783199416051232 0.000000000000000 6.276897008112217 2.127897707266902 
% 0.173062483602026 0.000000000000000 -0.065204558786428 0.000000000000000 2.830195579124920 0.000000000000000 6.278504967165860 2.111515559219222 
% 0.167629513666736 0.000000000000000 -0.065437514543205 0.000000000000000 2.879145860981518 0.000000000000000 6.280070795109317 2.094879262684104 
% 0.162198798890315 0.000000000000000 -0.065495592433898 0.000000000000000 2.930131604342330 0.000000000000000 6.281593424298225 2.078013945244408 
% 0.156780120698635 0.000000000000000 -0.065381628238268 0.000000000000000 2.983237187332512 0.000000000000000 6.283071893247224 2.060946858115567 
% 0.151383693029854 0.000000000000000 -0.065098973929174 0.000000000000000 3.038547055572447 0.000000000000000 6.284505268850560 2.043708084714071 
% 0.146020356791492 0.000000000000000 -0.064651683046925 0.000000000000000 3.096141827618260 0.000000000000000 6.285892579383227 2.026331274792817 
% 0.140701752765793 0.000000000000000 -0.064044727044276 0.000000000000000 3.156093379397094 0.000000000000000 6.287232761565941 2.008854351498907 
% 0.135440448902528 0.000000000000000 -0.063284233368958 0.000000000000000 3.218458932478569 0.000000000000000 6.288524626598528 1.991320105218915 
% 0.130249989451403 0.000000000000000 -0.062377726765263 0.000000000000000 3.283274370496938 0.000000000000000 6.289766851391048 1.973776551003467 
% 0.125144827617676 0.000000000000000 -0.061334343901038 0.000000000000000 3.350547287835694 0.000000000000000 6.290958001576170 1.956276895431490 
% 0.120140104794828 0.000000000000000 -0.060164980451980 0.000000000000000 3.420250596466611 0.000000000000000 6.292096591355127 1.938878950542268 
% 0.115251252783288 0.000000000000000 -0.058882323576885 0.000000000000000 3.492317790102866 0.000000000000000 6.293181181016964 1.921643867222277 
% 0.110493423590316 0.000000000000000 -0.057500726947151 0.000000000000000 3.566641050738290 0.000000000000000 6.294210505969224 1.904634153546614 
% 0.105880791571638 0.000000000000000 -0.056035904337414 0.000000000000000 3.643073145070322 0.000000000000000 6.295183622561987 1.887911091193685 
% 0.101425814172817 0.000000000000000 -0.054504450641809 0.000000000000000 3.721433447990664 0.000000000000000 6.296100048651371 1.871531831067952 
% 0.097138563985767 0.000000000000000 -0.052923238007866 0.000000000000000 3.801517567439037 0.000000000000000 6.296959874163584 1.855546577224744 
% 0.093026241975764 0.000000000000000 -0.051308766115922 0.000000000000000 3.883109211537498 0.000000000000000 6.297763821124322 1.839996295437920 
% 0.089092946520971 0.000000000000000 -0.049676556806357 0.000000000000000 3.965992456466737 0.000000000000000 6.298513243086218 1.824911284904185 
% 0.085339717152412 0.000000000000000 -0.048040669799336 0.000000000000000 4.049962622543891 0.000000000000000 6.299210066994220 1.810310760306330 
% 0.081764816288674 0.000000000000000 -0.046413384456995 0.000000000000000 4.134834485714778 0.000000000000000 6.299856691561765 1.796203379196016 
% 0.078364175044975 0.000000000000000 -0.044805055414655 0.000000000000000 4.220447293752348 0.000000000000000 6.300455861887034 1.782588488965718 
% 0.075131917739950 0.000000000000000 -0.043224119748382 0.000000000000000 4.306666740065971 0.000000000000000 6.301010539768291 1.769457796429884 
% 0.072060890019720 0.000000000000000 -0.041677216550502 0.000000000000000 4.393384494767791 0.000000000000000 6.301523784740288 1.756797176131097 
% 0.069143137601442 0.000000000000000 -0.040169376140984 0.000000000000000 4.480516066077152 0.000000000000000 6.301998654807100 1.744588399350424 
% 0.066370306696966 0.000000000000000 -0.038704241534163 0.000000000000000 4.567997728551227 0.000000000000000 6.302438130276554 1.732810648518047 
% 0.063733956992424 0.000000000000000 -0.037284294294606 0.000000000000000 4.655783104326077 0.000000000000000 6.302845060064962 1.721441755872072 
% 0.061225791349778 0.000000000000000 -0.035911066824287 0.000000000000000 4.743839801459773 0.000000000000000 6.303222127518787 1.710459159103411 
% 0.058837813554277 0.000000000000000 -0.034585331390508 0.000000000000000 4.832146349531626 0.000000000000000 6.303571831865525 1.699840599207642 
% 0.056562428036743 0.000000000000000 -0.033307262165577 0.000000000000000 4.920689547523662 0.000000000000000 6.303896481382783 1.689564601045345 
% 0.054392495265974 0.000000000000000 -0.032076570353806 0.000000000000000 5.009462254803513 0.000000000000000 6.304198194842864 1.679610780807265 
% 0.052321354825811 0.000000000000000 -0.030892614599400 0.000000000000000 5.098461605612902 0.000000000000000 6.304478908440189 1.669960021670061 
% 0.050342825981791 0.000000000000000 -0.029754489827305 0.000000000000000 5.187687601589300 0.000000000000000 6.304740386070970 1.660594552969081 
% 0.048451193340636 0.000000000000000 -0.028661097904155 0.000000000000000 5.277142026931964 0.000000000000000 6.304984231414841 1.651497961412406 
% 0.046641183268033 0.000000000000000 -0.027611203338134 0.000000000000000 5.366827630373864 0.000000000000000 6.305211900738811 1.642655156433579 
% 0.044907935146465 0.000000000000000 -0.026603476874285 0.000000000000000 5.456747522605457 0.000000000000000 6.305424715702595 1.634052306255199 
% 0.043246970319163 0.000000000000000 -0.025636529415628 0.000000000000000 5.546904744489505 0.000000000000000 6.305623875710213 1.625676756742489 
% 0.041654160638179 0.000000000000000 -0.024708938279253 0.000000000000000 5.637301968564318 0.000000000000000 6.305810469540480 1.617516941623222 
% 0.040125697857624 0.000000000000000 -0.023819267415334 0.000000000000000 5.727941303058840 0.000000000000000 6.305985486117327 1.609562290020137 
% 0.038658064629222 0.000000000000000 -0.022966082890147 0.000000000000000 5.818824173617980 0.000000000000000 6.306149824365298 1.601803135273639 
% 0.037248007512668 0.000000000000000 -0.022147964666575 0.000000000000000 5.909951263296891 0.000000000000000 6.306304302159339 1.594230627558352 
% 0.035892512197698 0.000000000000000 -0.021363515487929 0.000000000000000 6.001322495068369 0.000000000000000 6.306449664397438 1.586836651890622 
% 0.034588780967288 0.000000000000000 -0.020611367502673 0.000000000000000 6.092937045067496 0.000000000000000 6.306586590258703 1.579613752288538 
% 0.033334212345123 0.000000000000000 -0.019890187122884 0.000000000000000 6.184793377142213 0.000000000000000 6.306715699707440 1.572555062440969 
% 0.032126382805903 0.000000000000000 -0.019198678503338 0.000000000000000 6.276889291690871 0.000000000000000 6.306837559315094 1.565654242866706 
% 0.030963030399839 0.000000000000000 -0.018535585940296 0.000000000000000 6.369221983280439 0.000000000000000 6.306952687463500 1.558905424366664 
% 0.029842040123201 0.000000000000000 -0.017899695425816 0.000000000000000 6.461788103113507 0.000000000000000 6.307061558997214 1.552303157405583 
% 0.028761430869451 0.000000000000000 -0.017289835539183 0.000000000000000 6.554583823225954 0.000000000000000 6.307164609380739 1.545842367015024 
% 0.027719343796443 0.000000000000000 -0.016704877819506 0.000000000000000 6.647604900286312 0.000000000000000 6.307262238416964 1.539518312759536 
% 0.026714031955496 0.000000000000000 -0.016143736732244 0.000000000000000 6.740846737456151 0.000000000000000 6.307354813575783 1.533326553302483 
% 0.025743851041553 0.000000000000000 -0.015605369317459 0.000000000000000 6.834304443160137 0.000000000000000 6.307442672975074 1.527262915126284 
% 0.024807251132873 0.000000000000000 -0.015088774591323 0.000000000000000 6.927972886168569 0.000000000000000 6.307526128054613 1.521323464961939 
% 0.023902769305358 0.000000000000000 -0.014592992755593 0.000000000000000 7.021846746475576 0.000000000000000 6.307605465976674 1.515504485541911 
% 0.023029023015455 0.000000000000000 -0.014117104260981 0.000000000000000 7.115920561871289 0.000000000000000 6.307680951784961 1.509802454287101 
% 0.022184704160912 0.000000000000000 -0.013660228759089 0.000000000000000 7.210188770058872 0.000000000000000 6.307752830346506 1.504214024600158 
% 0.021368573736331 0.000000000000000 -0.013221523972904 0.000000000000000 7.304645746470235 0.000000000000000 6.307821328103355 1.498736009445902 
% 0.020579457012468 0.000000000000000 -0.012800184508865 0.000000000000000 7.399285837891979 0.000000000000000 6.307886654652973 1.493365366950037 
% 0.019816239176498 0.000000000000000 -0.012395440629502 0.000000000000000 7.494103392102135 0.000000000000000 6.307949004175810 1.488099187761128 
% 0.019077861377428 0.000000000000000 -0.012006557003007 0.000000000000000 7.589092783824595 0.000000000000000 6.308008556729230 1.482934683954052 
% 0.018363317130781 0.000000000000000 -0.011632831440740 0.000000000000000 7.684248437123507 0.000000000000000 6.308065479415813 1.477869179296818 
% 0.017671649037871 0.000000000000000 -0.011273593635576 0.000000000000000 7.779564844720808 0.000000000000000 6.308119927447302 1.472900100671758 
% 0.017001945785953 0.000000000000000 -0.010928203907409 0.000000000000000 7.875036584331004 0.000000000000000 6.308172045108943 1.468024970532324 
% 0.016353339396595 0.000000000000000 -0.010596051963566 0.000000000000000 7.970658332354136 0.000000000000000 6.308221966635327 1.463241400256502 
% 0.015725002694320 0.000000000000000 -0.010276555680248 0.000000000000000 8.066424875230652 0.000000000000000 6.308269817010368 1.458547084247931 
% 0.015116146973056 0.000000000000000 -0.009969159908083 0.000000000000000 8.162331118589028 0.000000000000000 6.308315712692285 1.453939794737288 
% 0.014526019837830 0.000000000000000 -0.009673335307036 0.000000000000000 8.258372094559666 0.000000000000000 6.308359762278881 1.449417377138763 
% 0.013953903204652 0.000000000000000 -0.009388577212430 0.000000000000000 8.354542967387934 0.000000000000000 6.308402067113321 1.444977745924612 
% 0.013399111442903 0.000000000000000 -0.009114404534015 0.000000000000000 8.450839037529089 0.000000000000000 6.308442721836936 1.440618880927165 
% 0.012860989645683 0.000000000000000 -0.008850358690341 0.000000000000000 8.547255744471046 0.000000000000000 6.308481814896295 1.436338824023859 
% 0.012338912016339 0.000000000000000 -0.008596002579164 0.000000000000000 8.643788668424317 0.000000000000000 6.308519429006553 1.432135676144976 
% 0.011832280360491 0.000000000000000 -0.008350919584620 0.000000000000000 8.740433531035004 0.000000000000000 6.308555641577822 1.428007594564616 
% 0.011340522674554 0.000000000000000 -0.008114712621058 0.000000000000000 8.837186195224572 0.000000000000000 6.308590525103637 1.423952790437134 
% 0.010863091821767 0.000000000000000 -0.007887003214382 0.000000000000000 8.934042664347547 0.000000000000000 6.308624147519642 1.419969526549560 
% 0.010399464289155 0.000000000000000 -0.007667430619869 0.000000000000000 9.030999080708552 0.000000000000000 6.308656572532112 1.416056115254246 
% 0.009949139018217 0.000000000000000 -0.007455650976882 0.000000000000000 9.128051723608044 0.000000000000000 6.308687859921762 1.412210916561569 
% 0.009511636304587 0.000000000000000 -0.007251336498651 0.000000000000000 9.225197006897506 0.000000000000000 6.308718065819654 1.408432336381480 
% 0.009086496760197 0.000000000000000 -0.007054174698025 0.000000000000000 9.322431476259935 0.000000000000000 6.308747242965524 1.404718824875437
% 0.272373959153627 0.000000000000000 0.000000000000000 0.000000000000000 2.162323602816495 0.000000000000000 6.239700794601118 2.376370061655153 
% 0.268721165213063 0.000000000000000 0.004381358844842 0.000000000000000 2.184086999512297 0.000000000000000 6.241544313713171 2.369078389571567 
% 0.267993837104515 0.000000000000000 0.008730985157857 0.000000000000000 2.187973781432940 0.000000000000000 6.241913217952656 2.367354387231316 
% 0.266794974810938 0.000000000000000 0.013018504524922 0.000000000000000 2.194404211692845 0.000000000000000 6.242517545996452 2.364505336624913 
% 0.265143488748454 0.000000000000000 0.017215899268554 0.000000000000000 2.203311499570923 0.000000000000000 6.243342484682392 2.360565607145761 
% 0.263063839793115 0.000000000000000 0.021298360820594 0.000000000000000 2.214610273133411 0.000000000000000 6.244369019174282 2.355579607931224 
% 0.260584450738166 0.000000000000000 0.025244747632509 0.000000000000000 2.228202983350332 0.000000000000000 6.245575288362343 2.349598873483272 
% 0.257736126933267 0.000000000000000 0.029037703030374 0.000000000000000 2.243986257558936 0.000000000000000 6.246937926468104 2.342679179053837 
% 0.254550650157635 0.000000000000000 0.032663498572063 0.000000000000000 2.261856543921459 0.000000000000000 6.248433248528620 2.334877988308999 
% 0.251059638795112 0.000000000000000 0.036111690687062 0.000000000000000 2.281714680571859 0.000000000000000 6.250038199122414 2.326252402219763 
% 0.247293702534624 0.000000000000000 0.039374676522784 0.000000000000000 2.303469287798576 0.000000000000000 6.251731040341677 2.316857657049145 
% 0.243281873648935 0.000000000000000 0.042447218615395 0.000000000000000 2.327039068038404 0.000000000000000 6.253491795593025 2.306746133985620 
% 0.239051271522646 0.000000000000000 0.045325986707662 0.000000000000000 2.352354198959627 0.000000000000000 6.255302488293382 2.295966796955080 
% 0.234626948483849 0.000000000000000 0.048009145161810 0.000000000000000 2.379357036757553 0.000000000000000 6.257147222294680 2.284564960523193 
% 0.230031867154999 0.000000000000000 0.050495998974278 0.000000000000000 2.408002334996961 0.000000000000000 6.259012149073580 2.272582295127134 
% 0.225286967152516 0.000000000000000 0.052786700966513 0.000000000000000 2.438257150820437 0.000000000000000 6.260885360022410 2.260056992098664 
% 0.220411288321719 0.000000000000000 0.054882016596777 0.000000000000000 2.470100570100838 0.000000000000000 6.262756733867281 2.247024029146020 
% 0.215422126651876 0.000000000000000 0.056783139876220 0.000000000000000 2.503523344625783 0.000000000000000 6.264617761243233 2.233515494215771 
% 0.210335206610280 0.000000000000000 0.058491552995610 0.000000000000000 2.538527501216997 0.000000000000000 6.266461361663632 2.219560940246090 
% 0.205164859620700 0.000000000000000 0.060008922638208 0.000000000000000 2.575125955325225 0.000000000000000 6.268281702784342 2.205187754878246 
% 0.199924202898357 0.000000000000000 0.061337026987028 0.000000000000000 2.613342139175200 0.000000000000000 6.270074027899480 2.190421537981057 
% 0.194625316091317 0.000000000000000 0.062477708767180 0.000000000000000 2.653209635402524 0.000000000000000 6.271834494792034 2.175286486367499 
% 0.189279415455641 0.000000000000000 0.063432851105100 0.000000000000000 2.694771789412554 0.000000000000000 6.273560027150567 2.159805789904244 
% 0.183897026811300 0.000000000000000 0.064204374419151 0.000000000000000 2.738081255949067 0.000000000000000 6.275248178530644 2.144002046681348 
% 0.178488159457490 0.000000000000000 0.064794253944774 0.000000000000000 2.783199416052143 0.000000000000000 6.276897008112265 2.127897707266597 
% 0.173062483601894 0.000000000000000 0.065204558786422 0.000000000000000 2.830195579126119 0.000000000000000 6.278504967165888 2.111515559218866 
% 0.167629513666627 0.000000000000000 0.065437514543215 0.000000000000000 2.879145860982502 0.000000000000000 6.280070795109370 2.094879262683766 
% 0.162198798890181 0.000000000000000 0.065495592433881 0.000000000000000 2.930131604343657 0.000000000000000 6.281593424298264 2.078013945244036 
% 0.156780120698528 0.000000000000000 0.065381628238273 0.000000000000000 2.983237187333561 0.000000000000000 6.283071893247253 2.060946858115174 
% 0.151383693029720 0.000000000000000 0.065098973929145 0.000000000000000 3.038547055573930 0.000000000000000 6.284505268850591 2.043708084713660 
% 0.146020356791488 0.000000000000000 0.064651683047050 0.000000000000000 3.096141827617818 0.000000000000000 6.285892579383256 2.026331274792623 
% 0.140701752765703 0.000000000000000 0.064044727044285 0.000000000000000 3.156093379398043 0.000000000000000 6.287232761565975 2.008854351498592 
% 0.135440448902415 0.000000000000000 0.063284233368929 0.000000000000000 3.218458932479982 0.000000000000000 6.288524626598551 1.991320105218601 
% 0.130249989451278 0.000000000000000 0.062377726765209 0.000000000000000 3.283274370498689 0.000000000000000 6.289766851391072 1.973776551003033 
% 0.125144827617590 0.000000000000000 0.061334343901051 0.000000000000000 3.350547287836686 0.000000000000000 6.290958001576218 1.956276895431158 
% 0.120140104794708 0.000000000000000 0.060164980451911 0.000000000000000 3.420250596468536 0.000000000000000 6.292096591355126 1.938878950541921 
% 0.115251252783169 0.000000000000000 0.058882323576807 0.000000000000000 3.492317790104936 0.000000000000000 6.293181181016966 1.921643867221908 
% 0.110493423590219 0.000000000000000 0.057500726947142 0.000000000000000 3.566641050739719 0.000000000000000 6.294210505969253 1.904634153546284 
% 0.105880791571531 0.000000000000000 0.056035904337325 0.000000000000000 3.643073145072512 0.000000000000000 6.295183622561992 1.887911091193332 
% 0.101425814172716 0.000000000000000 0.054504450641742 0.000000000000000 3.721433447992702 0.000000000000000 6.296100048651386 1.871531831067681 
% 0.097138563985670 0.000000000000000 0.052923238007802 0.000000000000000 3.801517567441104 0.000000000000000 6.296959874163607 1.855546577224448 
% 0.093026241975654 0.000000000000000 0.051308766115938 0.000000000000000 3.883109211539266 0.000000000000000 6.297763821124356 1.839996295437435 
% 0.089092946520880 0.000000000000000 0.049676556806327 0.000000000000000 3.965992456468630 0.000000000000000 6.298513243086219 1.824911284903879 
% 0.085339717152320 0.000000000000000 0.048040669799317 0.000000000000000 4.049962622545791 0.000000000000000 6.299210066994229 1.810310760306057 
% 0.081764816288573 0.000000000000000 0.046413384456997 0.000000000000000 4.134834485716777 0.000000000000000 6.299856691561804 1.796203379195630 
% 0.078364175044896 0.000000000000000 0.044805055414632 0.000000000000000 4.220447293754228 0.000000000000000 6.300455861887063 1.782588488965467 
% 0.075131917739852 0.000000000000000 0.043224119748385 0.000000000000000 4.306666740068104 0.000000000000000 6.301010539768327 1.769457796429395 
% 0.072060890019621 0.000000000000000 0.041677216550509 0.000000000000000 4.393384494770004 0.000000000000000 6.301523784740328 1.756797176130668 
% 0.069143137601396 0.000000000000000 0.040169376140952 0.000000000000000 4.480516066078664 0.000000000000000 6.301998654807104 1.744588399350195 
% 0.066370306696901 0.000000000000000 0.038704241534147 0.000000000000000 4.567997728553102 0.000000000000000 6.302438130276565 1.732810648517797 
% 0.063733956992355 0.000000000000000 0.037284294294594 0.000000000000000 4.655783104328113 0.000000000000000 6.302845060064956 1.721441755871686 
% 0.061225791349756 0.000000000000000 0.035911066824249 0.000000000000000 4.743839801460910 0.000000000000000 6.303222127518800 1.710459159103332 
% 0.058837813554233 0.000000000000000 0.034585331390486 0.000000000000000 4.832146349533298 0.000000000000000 6.303571831865527 1.699840599207389 
% 0.056562428036705 0.000000000000000 0.033307262165553 0.000000000000000 4.920689547525210 0.000000000000000 6.303896481382774 1.689564601045131 
% 0.054392495265952 0.000000000000000 0.032076570353775 0.000000000000000 5.009462254804724 0.000000000000000 6.304198194842865 1.679610780807101 
% 0.052321354825745 0.000000000000000 0.030892614599395 0.000000000000000 5.098461605615310 0.000000000000000 6.304478908440225 1.669960021669647 
% 0.050342825981729 0.000000000000000 0.029754489827298 0.000000000000000 5.187687601591644 0.000000000000000 6.304740386071005 1.660594552968706 
% 0.048451193340598 0.000000000000000 0.028661097904140 0.000000000000000 5.277142026933744 0.000000000000000 6.304984231414870 1.651497961411858 
% 0.046641183268005 0.000000000000000 0.027611203338115 0.000000000000000 5.366827630375378 0.000000000000000 6.305211900738835 1.642655156433066 
% 0.044907935146515 0.000000000000000 0.026603476874228 0.000000000000000 5.456747522604474 0.000000000000000 6.305424715702524 1.634052306255510 
% 0.043246970319105 0.000000000000000 0.025636529415625 0.000000000000000 5.546904744492105 0.000000000000000 6.305623875710201 1.625676756742082 
% 0.041654160637995 0.000000000000000 0.024708938279316 0.000000000000000 5.637301968571439 0.000000000000000 6.305810469540692 1.617516941622009 
% 0.040125697857551 0.000000000000000 0.023819267415343 0.000000000000000 5.727941303062127 0.000000000000000 6.305985486117422 1.609562290020007 
% 0.038658064629196 0.000000000000000 0.022966082890134 0.000000000000000 5.818824173619619 0.000000000000000 6.306149824365328 1.601803135273368 
% 0.037248007512655 0.000000000000000 0.022147964666555 0.000000000000000 5.909951263298069 0.000000000000000 6.306304302159298 1.594230627558110 
% 0.035892512197627 0.000000000000000 0.021363515487942 0.000000000000000 6.001322495071970 0.000000000000000 6.306449664397497 1.586836651889938 
% 0.034588780967281 0.000000000000000 0.020611367502652 0.000000000000000 6.092937045068446 0.000000000000000 6.306586590258661 1.579613752288658 
% 0.033334212345136 0.000000000000000 0.019890187122852 0.000000000000000 6.184793377142281 0.000000000000000 6.306715699707372 1.572555062441076 
% 0.032126382805890 0.000000000000000 0.019198678503322 0.000000000000000 6.276889291692130 0.000000000000000 6.306837559315091 1.565654242866400 
% 0.030963030399791 0.000000000000000 0.018535585940301 0.000000000000000 6.369221983283402 0.000000000000000 6.306952687463540 1.558905424366414 
% 0.029842040123180 0.000000000000000 0.017899695425806 0.000000000000000 6.461788103115221 0.000000000000000 6.307061558997189 1.552303157405917 
% 0.028761430869502 0.000000000000000 0.017289835539129 0.000000000000000 6.554583823223961 0.000000000000000 6.307164609380624 1.545842367015444 
% 0.027719343796357 0.000000000000000 0.016704877819541 0.000000000000000 6.647604900291618 0.000000000000000 6.307262238417072 1.539518312758447 
% 0.026714031955390 0.000000000000000 0.016143736732294 0.000000000000000 6.740846737462720 0.000000000000000 6.307354813576002 1.533326553301933 
% 0.025743851041512 0.000000000000000 0.015605369317466 0.000000000000000 6.834304443163191 0.000000000000000 6.307442672975095 1.527262915125942 
% 0.024807251132840 0.000000000000000 0.015088774591326 0.000000000000000 6.927972886171229 0.000000000000000 6.307526128054669 1.521323464961590 
% 0.023902769305314 0.000000000000000 0.014592992755605 0.000000000000000 7.021846746479019 0.000000000000000 6.307605465976723 1.515504485541768 
% 0.023029023015426 0.000000000000000 0.014117104260983 0.000000000000000 7.115920561873858 0.000000000000000 6.307680951784994 1.509802454286674 
% 0.022184704160877 0.000000000000000 0.013660228759096 0.000000000000000 7.210188770061902 0.000000000000000 6.307752830346588 1.504214024599830 
% 0.021368573736305 0.000000000000000 0.013221523972905 0.000000000000000 7.304645746472732 0.000000000000000 6.307821328103409 1.498736009445965 
% 0.020579457012492 0.000000000000000 0.012800184508826 0.000000000000000 7.399285837891068 0.000000000000000 6.307886654652863 1.493365366950137 
% 0.019816239176440 0.000000000000000 0.012395440629532 0.000000000000000 7.494103392107030 0.000000000000000 6.307949004175965 1.488099187760395 
% 0.019077861377436 0.000000000000000 0.012006557002981 0.000000000000000 7.589092783824801 0.000000000000000 6.308008556729172 1.482934683954152 
% 0.018363317130802 0.000000000000000 0.011632831440703 0.000000000000000 7.684248437122668 0.000000000000000 6.308065479415700 1.477869179296833 
% 0.017671649037840 0.000000000000000 0.011273593635588 0.000000000000000 7.779564844724028 0.000000000000000 6.308119927447360 1.472900100670386 
% 0.017001945785981 0.000000000000000 0.010928203907365 0.000000000000000 7.875036584329576 0.000000000000000 6.308172045108760 1.468024970533185 
% 0.016353339396519 0.000000000000000 0.010596051963622 0.000000000000000 7.970658332361130 0.000000000000000 6.308221966635594 1.463241400255498 
% 0.015725002694337 0.000000000000000 0.010276555680215 0.000000000000000 8.066424875230082 0.000000000000000 6.308269817010205 1.458547084248116 
% 0.015116146973057 0.000000000000000 0.009969159908067 0.000000000000000 8.162331118589822 0.000000000000000 6.308315712692227 1.453939794736592 
% 0.014526019837802 0.000000000000000 0.009673335307048 0.000000000000000 8.258372094562974 0.000000000000000 6.308359762278953 1.449417377138677 
% 0.013953903204645 0.000000000000000 0.009388577212421 0.000000000000000 8.354542967389394 0.000000000000000 6.308402067113345 1.444977745924739 
% 0.013399111442900 0.000000000000000 0.009114404534002 0.000000000000000 8.450839037530177 0.000000000000000 6.308442721836880 1.440618880927307 
% 0.012860989645715 0.000000000000000 0.008850358690290 0.000000000000000 8.547255744468906 0.000000000000000 6.308481814896065 1.436338824024599 
% 0.012338912016320 0.000000000000000 0.008596002579171 0.000000000000000 8.643788668427014 0.000000000000000 6.308519429006591 1.432135676144776 
% 0.011832280360488 0.000000000000000 0.008350919584608 0.000000000000000 8.740433531036103 0.000000000000000 6.308555641577808 1.428007594564644 
% 0.011340522674562 0.000000000000000 0.008114712621033 0.000000000000000 8.837186195224536 0.000000000000000 6.308590525103519 1.423952790437589 
% 0.010863091821784 0.000000000000000 0.007887003214348 0.000000000000000 8.934042664346652 0.000000000000000 6.308624147519433 1.419969526549432 
% 0.010399464289121 0.000000000000000 0.007667430619899 0.000000000000000 9.030999080713096 0.000000000000000 6.308656572532313 1.416056115253336 
% 0.009949139018210 0.000000000000000 0.007455650976877 0.000000000000000 9.128051723609623 0.000000000000000 6.308687859921691 1.412210916561085 
% 0.009511636304589 0.000000000000000 0.007251336498635 0.000000000000000 9.225197006898156 0.000000000000000 6.308718065819522 1.408432336381026 
% 0.009086496760198 0.000000000000000 0.007054174698011 0.000000000000000 9.322431476260675 0.000000000000000 6.308747242965438 1.404718824874812];


% 旋转系画图
figure(1); hold on; grid on; axis equal;

% 画EM系统
crtbpMarkEM;

for iLoop = 1 : size(X0Mtx , 1)
    
    % 提取初值和周期
    droXxi = X0Mtx(iLoop , 1:6);
    droPeriod = X0Mtx(iLoop , 7);
    
    % 画DRO
    crtbpFlow3D(droXxi , droPeriod , mu);
    
end

end

function [tt , xx] = crtbpFlow3D(xx0 , tf , mu)
%
% crtbp三维数值积分
%
% 例子：
% crtbpMarkEM
% aux = crtbpAuxEM;
% xx0 = [0.75 , 0 , 0 , 0.15 , 0 , 0];
% crtbpFlow3D(xx0 , 10 , aux.mu)
%
% 作者：张晨
% 单位：中科院空间应用工程与技术中心
% 时间：2021年3月30日
% chenzhang@csu.ac.cn
% -----------------------------------------------------------

options = odeset('Reltol', 1e-12, 'AbsTol',1e-12);

[tt , xx]=ode113(@fx , [0 , tf] , xx0 , options , mu);
plot3(xx(: , 1) , xx(: , 2) , xx(: , 3) , 'b');

% 动力学方程
    function dxxdt = fx (t, xx, mu)
        r1cube = ((xx(1) + mu)^2 + xx(2)^2 + xx(3)^2)^(1.5);
        r2cube = ((xx(1) - 1 + mu)^2 + xx(2)^2 + xx(3)^2)^(1.5);
        dxxdt = [xx(4);
            xx(5);
            xx(6);
            xx(1) + 2*xx(5) - (1 - mu) * (xx(1) + mu) / r1cube - mu*(xx(1) - 1 + mu) / r2cube;
            xx(2) - 2*xx(4) - (1 - mu) * xx(2) / r1cube - mu * xx(2) / r2cube;
            -(1 - mu) * xx(3) / r1cube - mu * xx(3) / r2cube];
    end

end

function crtbpMarkEM
%
% 画地球和月球
% 
% 作者：张晨
% 单位：中科院空间应用工程与技术中心
% 时间：2021年3月30日
% chenzhang@csu.ac.cn
% -----------------------------------------------------------

% leoFlag = 1; % 画leo
leoFlag = 0; % 画leo

% lloFlag = 1; % 画llo
lloFlag = 0; % 画llo

liFlag = 1; % 画平动点
% liFlag = 0; % 画平动点

% -------------------------------------------------------------
mu = 0.0121506683;
LU = 384405; % [km]

rSun = 6.955e5; % 太阳半径
rEarth = 6378; % 地球半径
rMoon = 1737; % 月球半径

altiLeo = 200; % 近地停泊轨道高度
altiLLO = 200; % 近月目标轨道高度

% ------------------------------------------------------------
% 画地球和月球
[xs , ys , zs] = sphere(30) ;
surf(-mu+xs*rEarth / LU,  ys*rEarth / LU, zs*rEarth / LU, 'FaceColor', 'w') ; hold on;
surf(1-mu+xs*rMoon / LU, ys*rMoon / LU, zs*rMoon / LU, 'FaceColor', 'w') ; hold on;

text( -mu,  0, 0, 'Earth') ; hold on;
text(1 - mu,  0, 0, 'Moon') ; hold on;

% 画LEO
if leoFlag == 1
    ri = (rEarth + altiLeo) / LU; % 近地停泊轨道地心距
    angle = 0 : 0.05 : 2*pi + 0.05 ;
    plot(-mu + ri*cos(angle), ri*sin(angle), 'k-.') ; hold on;
end

% 画LLO
if lloFlag == 1
    rf = (rMoon + altiLLO) / LU; % 近月目标轨道月心距
    plot(1-mu + rf*cos(angle), rf*sin(angle), 'k-.') ; hold on;
end

% 画平动点
if liFlag == 1
    [Li_pos , ~] = crtbpLi(mu);
    plot(Li_pos(1,1) , Li_pos(1,2) , 'r.' , 'linewidth' , 1);
    plot(Li_pos(2,1) , Li_pos(2,2) , 'r.' , 'linewidth' , 1);
    plot(Li_pos(3,1) , Li_pos(3,2) , 'r.' , 'linewidth' , 1);
    plot(Li_pos(4,1) , Li_pos(4,2) , 'r.' , 'linewidth' , 1);
    plot(Li_pos(5,1) , Li_pos(5,2) , 'r.' , 'linewidth' , 1);
    
    text(Li_pos(1,1) , Li_pos(1,2) , 'L1' , 'linewidth' , 1);
    text(Li_pos(2,1) , Li_pos(2,2) , 'L2' , 'linewidth' , 1);
    text(Li_pos(3,1) , Li_pos(3,2) , 'L3' , 'linewidth' , 1);
    text(Li_pos(4,1) , Li_pos(4,2) , 'L4' , 'linewidth' , 1);
    text(Li_pos(5,1) , Li_pos(5,2) , 'L5' , 'linewidth' , 1);
end

axis equal;
grid on;
xlabel('x (LU)');
ylabel('y (LU)');
zlabel('z (LU)');
view(0 , 90);

end

function [Li_pos , Li_c] = crtbpLi(mu)
% 计算crtbp的5个拉格朗日点和能量
%
% 例子：
% % [1]
% aux = crtbpAuxEM;
% [Li_pos , Li_c] = crtbpLi(aux.mu)
%
% % [2]
% aux = crtbpAuxSE;
% [Li_pos , Li_c] = crtbpLi(aux.mu)
%
% 作者：张晨
% 单位：中科院空间应用工程与技术中心
% 时间：2021年3月30日
% chenzhang@csu.ac.cn
% -----------------------------------------------------------
% 设置初始猜测值
x012 = (mu/3)^(1/3) ;
x03  = 1-(7/12)*mu  ;
% 计算5个平动点坐标
options = optimset('TolFun', 2.5e-14, 'TolX', 2.5e-14) ;
L1  = 1 - mu - fzero(@(x) x^5-(3-mu)*x^4+(3-2*mu)*x^3-mu*x^2+2*mu*x-mu, ...
    x012, options) ;
L2  = 1 - mu + fzero(@(x) x^5+(3-mu)*x^4+(3-2*mu)*x^3-mu*x^2-2*mu*x-mu, ...
    x012, options) ;
L3  =   - mu - fzero(@(x) x^5+(2+mu)*x^4+(1+2*mu)*x^3-(1-mu)*x^2-2*(1-mu)*x...
    -(1-mu), x03,  options) ;
L4x = 0.5 - mu ;
L4y = sqrt(3)/2 ;
% 构造5个平动点位置
Li_pos = [L1, 0;
    L2, 0;
    L3, 0;
    L4x, L4y;
    L4x, -L4y];
% 如果输出大于1则计算5个平动点能量
if nargout > 1
    xx = [Li_pos , zeros(5 , 2)];
    Li_c = crtbpJacobi2D(xx , mu);
end
end

function CC = crtbpJacobi2D (xx, mu)
% 计算雅可比能量C
%
% 输入：
% xx       [nx4]
% 输出：
% C        [nx1]
%
% 作者：张晨
% 单位：中科院空间应用工程与技术中心
% 时间：2021年3月30日
% chenzhang@csu.ac.cn
% -----------------------------------------------------------
if size(xx , 2) ~= 4
    disp('xx是n * 4')
end
r1 = sqrt((xx(: , 1)+mu).^2   + xx(: , 2).^2) ;
r2 = sqrt((xx(: , 1)+mu-1).^2 + xx(: , 2).^2) ;
CC = -(xx(: , 3).^2 + xx(: , 4).^2) ...
    + (xx(: , 1).^2 + xx(: , 2).^2) ...
    + 2 * (1 - mu) ./ r1 + 2 * mu ./ r2;
end

